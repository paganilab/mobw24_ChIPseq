<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2024 Bioinformatics Workshop - Day 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">2024 Bioinformatics Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../pages/index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../pages/Day1.html" aria-current="page"> 
<span class="menu-text">Day 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href=".././pages/day2.Rmd"> 
<span class="menu-text">Day 2</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/paganilab"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/LabPagani"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives">Objectives</a></li>
  <li><a href="#omics-experiments" id="toc-omics-experiments" class="nav-link" data-scroll-target="#omics-experiments"><em>Omics</em> experiments</a></li>
  <li><a href="#the-chip-seq-technology" id="toc-the-chip-seq-technology" class="nav-link" data-scroll-target="#the-chip-seq-technology">The ChIP-seq technology</a></li>
  <li><a href="#tips-for-designing-a-chip-seq-experiment" id="toc-tips-for-designing-a-chip-seq-experiment" class="nav-link" data-scroll-target="#tips-for-designing-a-chip-seq-experiment">Tips for designing a ChIP-seq experiment</a></li>
  <li><a href="#next-generation-sequencing" id="toc-next-generation-sequencing" class="nav-link" data-scroll-target="#next-generation-sequencing">Next Generation Sequencing</a></li>
  <li><a href="#setting-up-rstudio" id="toc-setting-up-rstudio" class="nav-link" data-scroll-target="#setting-up-rstudio">Setting up Rstudio</a></li>
  <li><a href="#the-rstudio-interface" id="toc-the-rstudio-interface" class="nav-link" data-scroll-target="#the-rstudio-interface">The RStudio Interface</a></li>
  <li><a href="#r-fundamentals" id="toc-r-fundamentals" class="nav-link" data-scroll-target="#r-fundamentals">R fundamentals</a>
  <ul class="collapse">
  <li><a href="#basic-computations" id="toc-basic-computations" class="nav-link" data-scroll-target="#basic-computations">Basic computations</a></li>
  <li><a href="#assigning-values-to-objects-with--" id="toc-assigning-values-to-objects-with--" class="nav-link" data-scroll-target="#assigning-values-to-objects-with--">Assigning values to objects with <code>&lt;-</code></a></li>
  </ul></li>
  <li><a href="#object-types-list" id="toc-object-types-list" class="nav-link" data-scroll-target="#object-types-list">Object types: <code>list</code></a>
  <ul class="collapse">
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  <li><a href="#data-frames" id="toc-data-frames" class="nav-link" data-scroll-target="#data-frames">Data frames</a></li>
  </ul></li>
  <li><a href="#create-an-rscript" id="toc-create-an-rscript" class="nav-link" data-scroll-target="#create-an-rscript">Create an Rscript</a></li>
  <li><a href="#install-the-packages" id="toc-install-the-packages" class="nav-link" data-scroll-target="#install-the-packages">Install the packages</a></li>
  <li><a href="#the-basics-of-chip-seq-data-processing" id="toc-the-basics-of-chip-seq-data-processing" class="nav-link" data-scroll-target="#the-basics-of-chip-seq-data-processing">The basics of ChIP-seq data processing</a>
  <ul class="collapse">
  <li><a href="#raw-sequencing-output" id="toc-raw-sequencing-output" class="nav-link" data-scroll-target="#raw-sequencing-output">Raw Sequencing Output</a></li>
  <li><a href="#quality-metrics-inspection" id="toc-quality-metrics-inspection" class="nav-link" data-scroll-target="#quality-metrics-inspection">Quality metrics inspection</a></li>
  <li><a href="#read-alignment" id="toc-read-alignment" class="nav-link" data-scroll-target="#read-alignment">Read alignment</a></li>
  <li><a href="#peak-calling" id="toc-peak-calling" class="nav-link" data-scroll-target="#peak-calling">Peak calling</a></li>
  <li><a href="#collapse-data-into-a-single-dataset" id="toc-collapse-data-into-a-single-dataset" class="nav-link" data-scroll-target="#collapse-data-into-a-single-dataset">Collapse data into a single dataset</a></li>
  <li><a href="#counting-reads-in-consensus-peaks" id="toc-counting-reads-in-consensus-peaks" class="nav-link" data-scroll-target="#counting-reads-in-consensus-peaks">Counting reads in consensus peaks</a></li>
  </ul></li>
  <li><a href="#the-tested-dataset" id="toc-the-tested-dataset" class="nav-link" data-scroll-target="#the-tested-dataset">The tested dataset</a></li>
  <li><a href="#load-and-explore-the-dataset" id="toc-load-and-explore-the-dataset" class="nav-link" data-scroll-target="#load-and-explore-the-dataset">Load and explore the dataset</a></li>
  <li><a href="#savingloading-files" id="toc-savingloading-files" class="nav-link" data-scroll-target="#savingloading-files">Saving/Loading Files</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Day 1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<style>
div.col pre { background-color:lightpink; }
div.col pre.r { background-color:white; }
</style>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives">Objectives</h2>
<ul>
<li>Introduction to ChIP-seq</li>
<li>Setting up R environment</li>
<li>Understanding ChIP-seq (and NGS) data <em>core</em> processing</li>
<li>Dataset introduction and exploration</li>
</ul>
</section>
<section id="omics-experiments" class="level2">
<h2 class="anchored" data-anchor-id="omics-experiments"><em>Omics</em> experiments</h2>
<p>‘Omics’ as disciplines <strong>work to</strong> <strong>answer questions</strong> regarding specific ‘omes’. These questions are enabled by omics experiments; in most cases, these will be <strong>sequencing- or mass-spectrometry based</strong>.</p>
<p>The identification of a suitable model, types and numbers of samples, the process of extraction and purification of our target ‘ome’, and finally its reformulation into a sequenceable product, i.e.&nbsp;<strong>a <em>library</em></strong>, <strong>shape the final bioinformatic dataset</strong> and <strong>place limits on the possible questions</strong> we will be able to ask of it.</p>
<blockquote class="blockquote">
<p>For example, in the case of RNA-seq, phenol-based extraction and precipitation will yield results that are not always comparable with total RNA extraction with a spin column. Even more, the contingent decision to perform ribodepletion or enrichment for polyadenylated transcript will have an impact even on simple gene expression analyses.</p>
</blockquote>
<p>Summing up, an Omics experiment is designed starting from a question, selecting the sample(s), wet lab procedure and library preparations that will enable the most truthful, informative dataset to be built.</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../pics/the_omics_design.png" class="img-fluid figure-img"></p>
<figcaption><strong>Designing Omics experiments: from question to dataset</strong></figcaption>
</figure>
</div>
</center>
</section>
<section id="the-chip-seq-technology" class="level2">
<h2 class="anchored" data-anchor-id="the-chip-seq-technology">The ChIP-seq technology</h2>
<p>In this context, we chose to deal with a Chromatin Immuno-precipitation (ChIP from now on) assay.&nbsp;</p>
<blockquote class="blockquote">
<p>💭 Suppose you have found an interesting, new histone variant, and managed to produce a strong antibody against it. You want to know where it’s located in the genome of your cells of interest (say, tumor cells), to start deducing its function.</p>
</blockquote>
<p>ChIP, coupled to sequencing (ChIP-seq), allows you to approach the question, <strong>genome-wide</strong>.</p>
<p>It works by extracting chromatin (DNA bound to protein), fragmenting it, and selecting the protein or protein variant of interest from this complex mixture with an antibody in some way specific for it. The <strong>subset of genome you will have isolated</strong> will constitute the sequences you expect your variant to bind, <strong>informing your inferences regarding its function</strong>.</p>
<blockquote class="blockquote">
<p>ChIP-seq use in mapping histone modifications has been seminal in epigenetics research! (Ku et al., <a href="https://pubmed.ncbi.nlm.nih.gov/21825079/">2011</a>)</p>
</blockquote>
<p>Here you can see a recap of the major steps:</p>
<pre><code>+ Cross-linking: add Formaldehyde
+ Cell lysis (breakdown of cell membranes)
+ Fragmentation of DNA fragments (shearing), e.g. digestion with specific endonuclease enzymes (dpn1) or sonication
+ Addition of specific bead-coupled antibody against the protein of interest, separating it from the mixture
+ Separate DNA from the protein (reverse cross-linking), and DNA purification
+ DNA fragment amplification, library construction
+ Library sequencing by NGS (essentially Illumina)</code></pre>
<center>
<div>
<p><img src="https://www.creativebiomart.net/epigenetics/wp-content/themes/epigenetics/upload/images/1-6-1-1-2-Transcription-Factor-ChIP-Seq-1.jpg" width="500"></p>
</div>
</center>
</section>
<section id="tips-for-designing-a-chip-seq-experiment" class="level2">
<h2 class="anchored" data-anchor-id="tips-for-designing-a-chip-seq-experiment">Tips for designing a ChIP-seq experiment</h2>
<p>Besides characterizing binding patterns in general, a common goal in ChIP-seq experiments is to <strong>identify changes in protein binding patterns</strong> between conditions, an application known as differential binding.</p>
<p>Effective analysis of ChIP-seq data requires sufficient coverage by sequence reads (<strong>sequencing depth</strong>). It mainly depends on the size of the genome, and the number and size of the binding sites of the protein.</p>
<ul>
<li><p>For mammalian (or any species with a relatively large genome) transcription factors (TFs) and chromatin modifications such as enhancer-associated histone marks: <strong>20 million reads</strong> are adequate</p></li>
<li><p>Proteins with more binding sites (e.g., RNA Pol II) or more promiscuous factors (e.g.&nbsp;CTCF) need more reads, up to <strong>60 million</strong> for mammalian ChIP-seq</p></li>
<li><p>Sequencing depth rules of thumb: &gt;10M reads for <em>narrow</em> peaks, &gt;20M for <em>broad</em> peaks (you will understand better this concept later in the <em>Peak Calling section</em>)</p></li>
</ul>
<p>Another consideration is about sequence modality: long &amp; paired-end reads are useful, but not essential - they may however help in specific, high-precision binding site discovery. Most of the times, ChIP-seq can be performed in <strong>single-end</strong> mode.</p>
<p>About the number of <strong>technical replicates</strong>, unlike with RNA-Seq, more than two replicates do not significantly increase the number of identified peaks.</p>
<section id="chip-controls" class="level4">
<h4 class="anchored" data-anchor-id="chip-controls">ChIP controls</h4>
<p>A successful ChIP-seq experiment must have the appropriate <strong>controls</strong> to optimize signal-noise ratio. Well-made controls help <strong>eliminate false positives</strong>. In fact, there is always some signal on open chromatin. This may be due to multiple factors, but can be boiled down to three reasons: <strong>A)</strong> non-specific binding from the antibody can precipitate random sequences <strong>B)</strong> digestion, sonication, or any other method of shearing will introduce biases towards certain sequences <strong>C)</strong> different operators will perform the same protocol slightly differently, yielding higher or lower signal/noise ratios.</p>
<p>The following controls are often used to abate these biases:</p>
<ul>
<li><p>An “<strong>input</strong>” DNA sample in which a library is generated from DNA that has been cross-linked and sonicated but not immuno-precipitated. It controls for the <strong>bias introduced before even immunoprecipitating</strong>, i.e.&nbsp;from sonication.</p></li>
<li><p>An <strong>IgG</strong> “mock”-ChIP, using an antibody that will not bind to nuclear proteins and should generate random immuno-precipitated DNA. It controls for <strong>non-specific sequences</strong> that precipitate alongside the target protein, but are not bound by it.</p></li>
<li><p>A <strong>Spike-In</strong> can also be introduced, using different genomes (e.g.&nbsp;Drosophila in a Human experiment) to control for handling <strong>variability</strong> between users, or batch differences between reagents. This helps dampen these confounders.</p></li>
</ul>
<blockquote class="blockquote">
<p><strong>Input DNA control is ideal</strong> in most of the cases. Indeed, one problem with IgG control is that if too little DNA is recovered after immuno-precipitation, sequencing library will be of low complexity and binding sites identified using this control could be biased. Read <a href="https://www.biostars.org/p/15817/">this biostars post</a> for discussion.</p>
</blockquote>
</section>
</section>
<section id="next-generation-sequencing" class="level2">
<h2 class="anchored" data-anchor-id="next-generation-sequencing">Next Generation Sequencing</h2>
<p>NGS technologies (Illumina/PacBio/Ultima/BGI) allow the processing of millions of synthesis reactions <strong>in parallel</strong>, resulting in high throughput, higher sensitivity, speed and reduced cost compared to first generation sequencing technologies (e.g., Sanger method).</p>
<blockquote class="blockquote">
<p>Given the vast amounts of quantitative sequencing data generated, NGS-based methods rely on resource-intensive <strong>data processing pipelines</strong> to analyze data.</p>
</blockquote>
<p>In addition to the sequence itself, and unlike Sanger sequencing, the high-throughput nature of NGS provides <strong>quantitative</strong> information (depth of coverage) due to the high level of sequence redundancy at a locus.</p>
<p>There are short-read and long-read NSG approaches. Short reads of NGS range in size <strong>from 75 to 300 bp</strong> depending on the application and sequencing chemistry. NGS is taken to mean second generation technologies, however 3G and 4G technologies have since evolved (enable longer read sequences in excess of <strong>10 kilobases</strong>).</p>
<p>Among 2G NGS chemistries, Illumina <strong>sequencing by synthesis</strong> (SBS) is the most widely adopted worldwide, responsible for generating more than 90% of the world’s sequencing data.</p>
<center>
<div>
<p><img src="https://efsa.onlinelibrary.wiley.com/cms/asset/3d005e92-0c1d-498a-b8d1-8796597dc74c/efs2e16086-fig-0004-m.jpg" width="500"></p>
</div>
<blockquote class="blockquote">
<p><strong>With this wealth of insights about the experiment at hand, we can now move forward to obtain the necessary equipment for analyzing this type of data effectively.</strong> 😎</p>
</blockquote>
</center></section>
<section id="setting-up-rstudio" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-rstudio">Setting up Rstudio</h2>
<p>First of all, let’s start assembling the tools that you will need for this workshop! While R by itself has no particular user interface, RStudio is the tool that allows you to click and actually ‘see’ what you are doing. RStudio is an <em>integrated development environment</em> (IDE) and will be our primary tool to interact with R.</p>
<p>You can follow two strategies:</p>
<ol type="1">
<li>Install <code>R</code> and RStudio on your machine</li>
<li>Run RStudio in a browser using RStudio Cloud.</li>
</ol>
<p>Note that the first option will require a bit more time and effort. To get started with RStudio Cloud (now Posit Cloud), click on <a href="https://posit.cloud/plans/free">this link</a> and create a Posit free account. Once you completed your registration, you are redirected to <code>Your Workspace</code>. To start a new R project, you can click on <code>New Project &gt; New RStudio Project</code>. This will open RStudio on the Cloud.</p>
</section>
<section id="the-rstudio-interface" class="level2">
<h2 class="anchored" data-anchor-id="the-rstudio-interface">The RStudio Interface</h2>
<p>Now that you have RStudio open, you should see something similar to this:</p>
<center>
<img src="../pics/posit_interface.png" width="800">
</center>
<p>The RStudio interface is composed of <em>quadrants</em>:</p>
<ol type="1">
<li><p>The <code>Console</code> window: located in the bottom-left, it’s where you will find the output of your coding, and it’s also possible to type <code>R</code> code <em>interactively</em> on the console.</p></li>
<li><p>The <code>Files / Plots / Packages / Help / Viewer</code> window: located in the bottom-right, it displays your <strong>current file system</strong> (on the Cloud), which is pointed to the position where your <code>Rproject</code> you just created lives.</p>
<ul>
<li><p>The <em>Files</em> pane lists the files and folders in your <strong>root directory</strong> (i.e.&nbsp;where by default RStudio saves your analyses).</p></li>
<li><p>Another important pane is <em>Plots</em>, designed to show you any plots you have created.</p></li>
<li><p>The <em>Package</em> pane instead allows to manage all the <strong>additional tools</strong> you can import and use when you perform your analyses. They are useful to enhance the basic R functions from different aspects.</p></li>
<li><p>If you need H E L P, you can use the <em>Help</em> pane: you can search for specific topics, for instance how a computation works and other kinds of documentation.</p></li>
</ul></li>
<li><p>The <code>Environment / History / Connections / Tutorial</code> window: you can find it in the top right position.</p>
<ul>
<li><p>It is pointed to the <em>Environment</em> pane, that is a place where you can find all the <em>objects</em> available for computation (e.g.&nbsp;datasets, plots, lists, etc.).</p></li>
<li><p>The <em>History</em> pane keeps whatever computation you run in the console. You can re-run the computation stored in the history and you can also copy the past code into an existing or new <em>R Script</em>.</p></li>
</ul></li>
</ol>
</section>
<section id="r-fundamentals" class="level2">
<h2 class="anchored" data-anchor-id="r-fundamentals">R fundamentals</h2>
<section id="basic-computations" class="level3">
<h3 class="anchored" data-anchor-id="basic-computations">Basic computations</h3>
<p>The most basic computation you can do in <em>R</em> is <strong>arithmetic operations</strong>. Let’s take a look at the following examples:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Addition</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span> <span class="sc">+</span> <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Division</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dv">14</span> <span class="sc">/</span> <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Square root</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.741657</code></pre>
</div>
</div>
<p>But R is much more than an enormous calculator! Besides arithmetic operations, there are also <strong>logical queries</strong> you can perform. Logical queries always return either the value <code>TRUE</code> or <code>FALSE</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1 Is it TRUE or FALSE?</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">==</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2 Is 45 bigger than 55?</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span> <span class="sc">&gt;</span> <span class="dv">56</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3 Are these two words NOT the same?</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="st">"Gene"</span> <span class="sc">!=</span> <span class="st">"gene"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Notice that in logical queries, <code>equal to</code> is represented by <code>==</code> and not by <code>=</code> , which instead is used to assign a value to an object. However, in practice, most <em>R</em> programmers tend to avoid <code>=</code> since it can easily lead to confusion with <code>==</code>.</p>
</blockquote>
</section>
<section id="assigning-values-to-objects-with--" class="level3">
<h3 class="anchored" data-anchor-id="assigning-values-to-objects-with--">Assigning values to objects with <code>&lt;-</code></h3>
<p>Assigning values to objects is another common task that we will perform. What can be an <em>object</em> ?</p>
<ul>
<li>a list of names</li>
<li>a series of number</li>
<li>a dataset</li>
<li>a plot</li>
<li>a function</li>
<li>etc.</li>
</ul>
<p>In short, an object can enclose different things which form part of your data analysis. For example, objects are useful to <strong>store results</strong> that you want to process further in later steps of the analysis. We have to use the assign operator <code>&lt;-</code> to assign a value to an object. Let’s have a look at an example:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's assign the gene "TP53" to the "genes" object</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">&lt;-</span> <span class="st">"TP53"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the object <code>genes</code> carries the value <code>"TP53"</code>. If you check out the <em>Environment</em> pane, you should see that the <code>gene</code> object appeared there. We can also <strong>print values</strong> of an object in the console by simply typing the name of the object <code>genes</code> and hit <code>Return ↵</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What are my genes?</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>genes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TP53"</code></pre>
</div>
</div>
<p>To create <strong>objects with multiple values</strong>, we can use the function <code>c()</code> which stands for ‘concatenate’:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding some more genes to the object</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TP53"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"TNF"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"EGFR"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">"VEGFA"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">"APOE"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">"IL6"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Here are my genes</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>genes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TP53"  "TNF"   "EGFR"  "VEGFA" "APOE"  "IL6"  </code></pre>
</div>
</div>
<p>To concatenate values into a single object, we need to use a comma <code>,</code> to separate each value. Otherwise, <em>R</em> will report an error back.</p>
<div class="col">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TP53"</span> <span class="st">"TNF"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: &lt;text&gt;:1:19: unexpected string constant
1: genes &lt;- c("TP53" "TNF"
                      ^</code></pre>
</div>
</div>
</div>
<p>Don’t worry about it! R’s error messages tend to be very useful and give meaningful clues to what went wrong. In this case, we can see that something ‘unexpected’ happened and it shows where our mistake is.</p>
</section>
</section>
<section id="object-types-list" class="level2">
<h2 class="anchored" data-anchor-id="object-types-list">Object types: <code>list</code></h2>
<p>Values inside objects are meant to be of the same <em>type</em>, for instance <em>numeric</em> or <em>character</em>. Consequently, mixing different types of data into one object is likely a bad idea. However, there is an exception: a <em>list</em> object can hold other objects of different data types.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">list</span>(genes,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">"TGFB1"</span>, <span class="dv">5</span>, <span class="st">"AKT1"</span>, <span class="dv">6</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "TP53"  "TNF"   "EGFR"  "VEGFA" "APOE"  "IL6"  

[[2]]
[1] 1 2 3 4

[[3]]
[1] "TGFB1" "5"     "AKT1"  "6"    </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>You will notice in this example that we do not use <code>""</code> for each value in the list. This is because <code>genes</code> is not a <code>character</code> value, but an object. When we refer to objects, we <strong>do not need quotation marks</strong>.</p>
</blockquote>
<p>Looking at the list item in the environment page, you can see that the object <code>data</code> is classified as a <code>List of 3,</code> and if you click on the blue icon, you can inspect the different objects inside.</p>
<center>
<img src="../pics/list_environment.png" class="img-fluid" width="500">
</center>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<p>We mention the term ‘<em>function</em>’ multiple times, but what are functions and why we need them? In simple terms, <strong>functions are objects</strong> that contain lines of codes and can be seen as shortcuts for our programming. They are useful to save space and time and to make our code more readable and reliable. We will make an example to understand better, by calculating the arithmetic mean:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We create an object that stores our values</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">4</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">5</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually compute the sum </span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">7</span> <span class="sc">+</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">13</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">9</span> <span class="sc">+</span> <span class="dv">5</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide the sum by the number of values</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>mean <span class="ot">&lt;-</span> sum <span class="sc">/</span> <span class="dv">8</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>mean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.75</code></pre>
</div>
</div>
<p>Or…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the mean function that is part of the R base package</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.75</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's check that the two methods coincide</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>sum <span class="sc">/</span> <span class="dv">8</span> <span class="sc">==</span> <span class="fu">mean</span>(values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="data-frames" class="level3">
<h3 class="anchored" data-anchor-id="data-frames">Data frames</h3>
<p>The last type of objects we will see (of course there are far many more types…) is the <em>data.frame</em>, one of the most abundantly used in <code>R</code>. Think of data.frames as the R equivalent of Excel spreadsheets, so a way to store tabular data. As we will see later, pretty much all the data we are going to handle will be in the form of a data.frame or some of its other variations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's create and display a data frame (a table) with four rows and two columns</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">"Class"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"a"</span>,<span class="st">"b"</span>,<span class="st">"c"</span>,<span class="st">"d"</span>), <span class="co"># First column</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Quantity"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">4</span>,<span class="dv">6</span>)) <span class="co"># Second column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Class Quantity
1     a        1
2     b       10
3     c        4
4     d        6</code></pre>
</div>
</div>
<p>We have instructed R to create a data.frame object. We will give more of these commands from now on!</p>
</section>
</section>
<section id="create-an-rscript" class="level2">
<h2 class="anchored" data-anchor-id="create-an-rscript">Create an Rscript</h2>
<p>You might want to save your code for a later use, especially when it starts to become long and complex. In this case, it is not very convenient to write it in the console, which does not keep track of it (as far as you don’t go back in the <em>History</em>) and does not allow to edit the code and save changes.</p>
<p>So, instead, we can write code into an <strong>R Script</strong>, which is a document that RStudio recognizes as <em>R programming code</em> and has <code>.R</code> as extension. Files that are not R Scripts, like <code>.txt</code>, <code>.rtf</code> or <code>.md</code>, can also be opened in RStudio, but any code written in it will not be <strong>automatically recognized</strong>.</p>
<p>When opening an R script or creating a new one, it will display in the <em>Source</em> window. The term ‘source’ can be understood as any type of file, e.g.&nbsp;data, programming code, notes, etc.</p>
<blockquote class="blockquote">
<p>Now let’s create an R script, by selecting <code>File &gt; New File &gt; R Script</code> in the menu bar, or using the keyboard shortcut <code>Ctrl + Shift + N</code> on PC and <code>Cmd + Shift + N</code> on Mac. We will name it “Day1.R”.</p>
<p>Now you can go in the <em>History</em>, copy the lines previously coded (by clicking on the first line you want to copy, then pressing <code>Shift + Down arrow</code>, up to the last line of code) and then click <code>To Source</code>.</p>
<p>❗️ Writing some code in your <em>R script</em> will NOT automatically run it! If you tried pressing <code>Return ↵</code>, you would only add a new line. Instead, you need to select the code you want to run and press <code>Ctrl+Return ↵</code> (PC) or <code>Cmd+Return ↵</code> (Mac).</p>
</blockquote>
</section>
<section id="install-the-packages" class="level2">
<h2 class="anchored" data-anchor-id="install-the-packages">Install the packages</h2>
<p>The analyses we are going to perform require specific <em>functions</em> that are not included in the basic set of functions in R. These functions are collected in specific <em>packages</em>. R packages are extensions to the R programming language that contain code, data and documentation which help us performing standardized workflows. In the chunk below, we instruct R to install the packages that we will need later on through the workshop.</p>
<blockquote class="blockquote">
<p>Copy this chunk and paste it to your R script.</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages from Bioconductor</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"BiocManager"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"BiocManager"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages from CRAN</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"googledrive"</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># For differential analysis</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">"vsn"</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">"edgeR"</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"statmod"</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># For visualizations</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"hexbin"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"pheatmap"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"RColorBrewer"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggrepel"</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"circlize"</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co"># For downstream analysis</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"gprofiler2"</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean garbage</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>During the installation, you will see many messages being displayed on your R console, don’t pay too much attention to them unless they are <strong>red and specify an error</strong>!</p>
<p>If you encounter any of these messages during installation, follow this procedure here:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R asks for package updates, answer "n" and type enter</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Question displayed:</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>Update all<span class="sc">/</span>some<span class="sc">/</span>none? [a<span class="sc">/</span>s<span class="sc">/</span>n]<span class="sc">:</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Answer to type:  </span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>n</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># R asks for installation from binary source, answer "no" and type enter</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Question displayed:</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>Do you want to install from sources the packages which need compilation? (Yes<span class="sc">/</span>no<span class="sc">/</span>cancel)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Answer to type:</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>no</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While the packages are installed, we can start diving into the ChIP-seq <em>core</em> processing steps.</p>
</section>
<section id="the-basics-of-chip-seq-data-processing" class="level2">
<h2 class="anchored" data-anchor-id="the-basics-of-chip-seq-data-processing">The basics of ChIP-seq data processing</h2>
<section id="raw-sequencing-output" class="level3">
<h3 class="anchored" data-anchor-id="raw-sequencing-output">Raw Sequencing Output</h3>
<p>The <strong>raw output</strong> of any sequencing run consists of a series of sequences (called <em>tags</em> or <strong><em>reads</em></strong>). These sequences can have varying length based on the run parameters set on the sequencing platform. Nevertheless, <strong>they are made available for humans to read under a standardized file format known as FASTQ</strong>. This is the universally accepted format used to encode sequences after sequencing. An example of real FASTQ file with only two <strong><em>reads</em></strong> is provided below.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>Seq1</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>AGTCAGTTAAGCTGGTCCGTAGCTCTGAGGCTGACGAGTCGAGCTCGTACG</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>BBBEGGGGEGGGFGFGGEFGFGFGGFGGGGGGFGFGFGGGFGFGFGFGFG</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>Seq2</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>TGCTAAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGCTAGC</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>FASTQ files are an intermediate file in the analysis</strong> and are used to assess quality metrics for any given sequence. The <strong>quality of each base call</strong> is encoded in the line after the <code>+</code> following the standard <a href="https://en.wikipedia.org/wiki/Phred_quality_score"><strong>Phred score</strong></a> system.</p>
<blockquote class="blockquote">
<p>💡 <strong>Since we now have an initial metric for each sequence, it is mandatory to conduct some standard quality control evaluation of our sequences to eventually spot technical defects in the sequencing run early on in the analysis.</strong></p>
</blockquote>
</section>
<section id="quality-metrics-inspection" class="level3">
<h3 class="anchored" data-anchor-id="quality-metrics-inspection">Quality metrics inspection</h3>
<p>Computational tools like <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a> aid with the <strong>visual inspection of per-sample quality metrics</strong> from NGS experiments. Some of the QC metrics of interest to consider include the ones listed below, on the <strong>left</strong> are optimal metric profiles while on the <strong>right</strong> are sub-optimal ones:</p>
<center>
<strong>Per-base Sequence Quality</strong> <img src="https://nbisweden.github.io/workshop-ngsintro/2001/data/rnaseq/pbsq.jpg" width="800"> <em>This uses <strong>box plots</strong> to highlight the per-base quality along all <strong>reads in the sequencing experiment, we can notice a physiological drop in quality towards the end part of the read</strong>.</em>
</center>
<center>
<strong>Per-sequence Quality Scores</strong> <img src="https://nbisweden.github.io/workshop-ngsintro/2001/data/rnaseq/psqs.jpg" width="800"> <em>Here we are plotting the <strong>distribution of Phred scores</strong> across all identified sequences, we can see that the high quality experiment (left) has a peak at higher Phred scores values (34-38).</em>
</center>
<center>
<strong>Per-base Sequence Content</strong> <img src="https://nbisweden.github.io/workshop-ngsintro/2001/data/rnaseq/pbsc.jpg" width="800"> <em>Here we check the sequence (read) base content, in a normal scenario we do not expect any dramatic variation across the full length of the read since we should see a quasi-balanced distribution of bases.</em>
</center>
<center>
<strong>Per-sequence GC Content</strong> <img src="https://nbisweden.github.io/workshop-ngsintro/2001/data/rnaseq/psgc.jpg" width="800"> <em>GC-content refers to the <strong>degree at which guanosine and cytosine are present within a sequence</strong>, in NGS experiments which also include PCR amplification this aspect is crucial to check since GC-poor sequences may be enriched due to their easier <strong>amplification bias</strong>. In a normal random library we would expect this to have a bell-shaped distribution such as the one on the left.</em>
</center>
<center>
<strong>Sequence Duplication Levels</strong> <img src="https://nbisweden.github.io/workshop-ngsintro/2001/data/rnaseq/sdl.jpg" width="800"> <em>This plot shows the degree of sequence duplication levels. In a normal library (left) we <strong>expect to have low levels of duplication</strong> which can be a positive indicator of high sequencing coverage.</em>
</center>
<center>
<strong>Adapter Content</strong> <img src="https://nbisweden.github.io/workshop-ngsintro/2001/data/rnaseq/ac.jpg" width="800"> <em>In NGS experiments we use <strong>adapters</strong> to create a library. Sometimes these can get sequenced accidentally and end up being part of a <strong>read</strong>. This phenomenon can be spotted here and corrected using a computational approach called <strong>adapter trimming</strong>.</em>
</center>
<p>The <strong>read trimming</strong> step consists of removing a variable portion of read extremities that contain adapters/have suboptimal quality indicated by the Phred score. Tools like <code>Cutadapt</code> can be used to perform this task after read QC, and FASTQC can be eventually run just after read trimming to double-check positive effect of getting rid of bad sequences. Note that after this step, reads might have different lengths.</p>
</section>
<section id="read-alignment" class="level3">
<h3 class="anchored" data-anchor-id="read-alignment">Read alignment</h3>
<p>Now that we have assessed the quality of the sequencing data, we are ready to align the reads to the <strong>reference genome</strong> in order to <strong>map the exact chromosomal</strong> location they derive from.</p>
<blockquote class="blockquote">
<p>A reference genome is a set of nucleic acid sequences assembled as a representative example of a species’ genetic material. It does not accurately represent the set of genes of any single organism, but a <em>mosaic</em> of different nucleic acid sequences from each individual. For each model organism, <strong>several possible reference genomes may be available</strong> (e.g.&nbsp;hg19 and hg38 for human).</p>
<p>As the cost of DNA sequencing falls, and new full genome sequencing technologies emerge, more genome sequences continue to be generated. New alignments are built and the reference genomes improved (fewer gaps, fixed misrepresentations in the sequence, etc). The different reference genomes correspond to the different released versions (called “<strong>builds</strong>”).</p>
</blockquote>
<p>A mapper tool takes as input a reference genome and a set of reads. Its aim is to <strong>match each read sequence with the reference genome sequence</strong>, allowing mismatches, indels and clipping of some short fragments on the two ends of the reads.</p>
<center>
<strong>Illustration of the mapping process</strong> <img src="https://training.galaxyproject.org/training-material/topics/sequence-analysis/images/mapping/mapping.png" width="500">
</center>
<p>Among the different mappers, <code>Bowtie2</code> is a fast and open-source aligner particularly good at aligning sequencing reads of about 50 up to 1,000s of bases to relatively long genomes. By default, it performs a <em>global end-to-end</em> read alignment and by changing the settings, it also supports the <em>local alignment mode</em>. You can understand the difference by looking at this scheme:</p>
<center>
<img src="https://crc-pages.pitt.edu/user-manual/_assets/img/advanced-genomics-support/chipseq_06.png" width="500">
</center>
<p>Bowtie2 can identify reads that are:</p>
<ol type="1">
<li><p><strong>uniquely mapped</strong>: read pairs aligned exactly 1 time</p></li>
<li><p><strong>multi-mapped</strong>: reads pairs aligned more than 1 time</p></li>
<li><p><strong>unmapped</strong>: read pairs non concordantly aligned or not aligned at all</p></li>
</ol>
<blockquote class="blockquote">
<p>Multi-mapped reads can happen because of repetition in the reference genome (e.g.&nbsp;multiple copies of a gene), particularly when reads are small. It is difficult to decide where these sequences come from and therefore <strong>most of the pipelines ignore them</strong>.</p>
</blockquote>
<section id="mapping-statistics" class="level4">
<h4 class="anchored" data-anchor-id="mapping-statistics">Mapping statistics</h4>
<p>Checking the mapping statistics is an important step to perform before to continue any analyses. There are several potential <strong>sources for errors in mapping</strong>, including (but not limited to):</p>
<ul>
<li><p>PCR artifacts: PCR errors will show as mismatches in the alignment</p></li>
<li><p>sequencing errors</p></li>
<li><p>error of the mapping algorithm due to repetitive regions or other low-complexity regions.</p></li>
</ul>
<p>A <strong>low percentage of uniquely mapped reads</strong> is often due to (i) either excessive amplification in the PCR step, (ii) inadequate read length, or (iii) problems with the sequencing platform.</p>
<blockquote class="blockquote">
<p><strong>70% or higher</strong> is considered a good percentage of uniquely mapped reads over all the reads, whereas 50% or lower is concerning. The percentages are not consistent across different organisms, thus the rule can be flexible!</p>
</blockquote>
<p>But where the read mappings are stored?</p>
</section>
<section id="the-bam-file-format" class="level4">
<h4 class="anchored" data-anchor-id="the-bam-file-format">The BAM file format</h4>
<p>A BAM (Binary Alignment Map) file is a <em>compressed binary file</em> storing the read sequences, whether they have been aligned to a reference sequence (e.g., a chromosome), and if so, the position on the reference sequence at which they have been aligned.</p>
<p>A BAM file (or a SAM file, the non-compressed version) consists of:</p>
<ul>
<li><p>A <strong>header section</strong> (the lines starting with @) containing <em>metadata</em>, particularly the chromosome names and lengths (lines starting with the <span class="citation" data-cites="SQ">@SQ</span> symbol)</p></li>
<li><p>An <strong>alignment section</strong> consisting of a table with 11 mandatory fields, as well as a variable number of optional fields.</p></li>
</ul>
<center>
<strong>BAM file format</strong> <img src="https://i2.wp.com/bioinformaticamente.com/wp-content/uploads/2021/03/sam_format_annotated_example.5108a0cd-1.jpg?resize=616%2C328&amp;ssl=1" width="500">
</center>
<p>Questions:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Which information do you find in a BAM file that you also find in the FASTQ file?</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sequences and quality information</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>What is the additional information compared to the FASTQ file?</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapping information, Location of the read on the chromosome, Mapping quality, etc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="peak-calling" class="level3">
<h3 class="anchored" data-anchor-id="peak-calling">Peak calling</h3>
<p>The read count data generated by ChIP-seq is massive. In order to predict <em>the actual sites where the protein of interest is likely to bind</em>, different peak calling methods have been developed. <strong>Peaks</strong> are regions with <strong>significant number of mapped reads that produce a <em>pileup</em></strong>.</p>
<blockquote class="blockquote">
<p>ChIP-seq is most often performed with <strong>single-end reads</strong>, and ChIP fragments are sequenced from their 5’ ends only. This creates <strong>two distinct peaks of read density</strong>! One on each strand with the binding site falling in the middle of these peaks. The distance from the middle of the peaks to the binding site is often referred to as the “<em>shift</em>”.</p>
</blockquote>
<center>
<p><img src="https://www.ncbi.nlm.nih.gov/pmc/articles/instance/2917543/bin/nihms223699f1.jpg" width="400"></p>
<p><em>Forward (blue) and reverse (maroon) Read Density Profiles derived from the read data contribute to the Combined Density Profile (orange). <a href="https://pubmed.ncbi.nlm.nih.gov/19160518/">Nat. Methods,2008</a></em></p>
</center>
<p>The most popular tool to find peaks is <strong>MACS2</strong> which empirically models the <strong>shift size</strong> of ChIP-Seq reads, and uses it to improve the spatial resolution of predicted binding sites. Briefly, these are <strong>the steps</strong> performed by MACS:</p>
<ol type="1">
<li><p>removing duplicate reads</p></li>
<li><p>modelling the shift size</p></li>
<li><p>scaling the libraries with respect to their controls</p></li>
<li><p>performing peak detection</p></li>
<li><p>estimating False Discovery Rate (FDR)</p></li>
</ol>
<p>The peak detection identifies areas in the genome that have been <strong>enriched</strong> <strong>with mapped reads</strong>.</p>
<blockquote class="blockquote">
<p>Enrichment = Immunoprecipitation reads/background reads (mock IP or untagged IP).</p>
<p>If an experimental control data is NOT available, a <em>random genomic background</em> is assumed.</p>
</blockquote>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../pics/chip_peakcalling.png" class="img-fluid figure-img" width="421"></p>
<figcaption><strong>Overview of the Peak Calling step</strong></figcaption>
</figure>
</div>
</center>
<p>Finally, peaks are filtered to reduce <em>false positives</em> and ranked according to relative strength or statistical significance.</p>
<section id="different-peak-profiles" class="level4">
<h4 class="anchored" data-anchor-id="different-peak-profiles">Different peak profiles</h4>
<p>An important factor that influences the sequencing depth that is required for a ChIP–seq experiment is whether the protein (or chromatin modification) is a point-source factor, a broad-source factor or a mixed-source factor.</p>
<ul>
<li><p><strong>Point sources</strong> occur at specific locations in the genome. This class includes sequence-specific transcription factors as well as some highly localized chromatin marks, for example, those associated with enhancers and transcription start sites. They will generate more often <strong><em>narrow</em></strong> <strong>peaks</strong>.</p></li>
<li><p><strong>Broad sources</strong> are generally those that cover extended areas of the genome, such as many chromatin marks (for example, histone H3 lysine 9 trimethylation (H3K9me3) marks). They will give raise to <strong>broad peaks</strong>.</p></li>
<li><p><strong>Mixed-source factors</strong>, such as RNA polymerase II, yield both types of peaks. As expected, broad-source and mixed-source factors require a greater number of reads than point-source factors. Peaks generated will have a <strong>mixed profile between narrow and broad</strong>.</p></li>
</ul>
<center>
<img src="https://media.springernature.com/lw685/springer-static/image/art%3A10.1038%2Fnrg3642/MediaObjects/41576_2014_Article_BFnrg3642_Fig2_HTML.jpg" width="500">
</center>
</section>
<section id="additional-qc-metrics" class="level4">
<h4 class="anchored" data-anchor-id="additional-qc-metrics">Additional QC metrics</h4>
<p>After peak calling, it’s important to check some metrics that are indicative of the overall quality of the ChIP-seq experiment. Here are two of the most useful:</p>
<ul>
<li><p><em>FRiP score</em>: reports the percentage of reads overlapping within called peak. Can be useful to understand how much the IP sample is “enriched”.</p></li>
<li><p><em>Strand cross-correlation</em>: high-quality ChIP-seq produces significant clustering of enriched reads at locations bound by the protein of interest, that present as a bimodal density profile on the forward and reverse strands (peaks). The cross-correlation metric calculates how many bases to shift the bimodal peaks in order to get the maximum correlation between the two read clusters, which corresponds to the <em>predominant <strong>fragment length</strong></em>.</p></li>
</ul>
</section>
<section id="bigwig-and-bed-file-formats" class="level4">
<h4 class="anchored" data-anchor-id="bigwig-and-bed-file-formats">BigWig and BED file formats</h4>
<p>Most high-throughput data can be viewed as a <strong><em>continuous</em></strong> <strong>score</strong> over the bases of the genome. In case of RNA-seq or ChIP-seq experiments, the data can be represented as <strong>read coverage values per genomic base position</strong>.</p>
<p>This sort of data can be stored as a generic text file or can have special formats such as Wig (stands for wiggle) from UCSC, or the <strong>bigWig format</strong>, which is an indexed binary format of the wig files.</p>
<blockquote class="blockquote">
<p>The bigWig format is great for data that covers a large fraction of the genome with varying and continuous scores, because the file is much smaller than regular text files that have the same information and it can be queried more easily since <strong>it is indexed</strong>. Most of the ENCODE project data can be downloaded in bigWig format!</p>
</blockquote>
<p>If we want to know instead the peak locations in the genome as <strong>chromosome coordinates with well defined <em>start</em> and <em>end</em> positions</strong>, we want to look at BED files, that are the main output of the peak calling step.</p>
<p>A typical BED file is a text file format used to store genomic regions as coordinates. The data are presented in form of columns separated by <em>tabs</em>. This is the structure of a standard BED file, which can have also additional columns.</p>
<center>
<img src="https://hbctraining.github.io/Intro-to-ChIPseq-flipped/img/bed.png" width="400">
</center>
<blockquote class="blockquote">
<p>We will use this file type to inspect peak locations and for future downstream analyses!</p>
</blockquote>
</section>
</section>
<section id="collapse-data-into-a-single-dataset" class="level3">
<h3 class="anchored" data-anchor-id="collapse-data-into-a-single-dataset">Collapse data into a single dataset</h3>
<p>Imagine that you are performing these steps of read processing not just for one library, but for a collection of samples <em>with different replicates and experimental conditions</em>, and you subsequently want to make differential comparisons across conditions. To this aim, it’s necessary to collapse the single peak files obtained from each single library into a single <strong><em>consensus</em></strong> <strong>peakset</strong>.</p>
<p>In this step you can also add a filtering to exclude genomic intervals that are identified as peaks only in a minority of samples. <code>DiffBind</code> and <code>BEDTools</code> are two common programs that can handle this task.</p>
<p>It can be helpful to make a plot of how many peaks overlap in how many samples, like this one:</p>
<center>
<p><img src="https://bioinformatics-core-shared-training.github.io/Quantitative-ChIPseq-Workshop/articles/Quantitative-ChIPseq-Workshop_files/figure-html/rateplot-1.png" width="400"></p>
<p><em>This plot shows that there are almost 4000 total merged peaks, representing the union of all intervals. At the other extreme, there are around 100 peaks that overlap in all 11 samples, representing the intersection of all the samples.</em></p>
</center>
<blockquote class="blockquote">
<p>Which should we chose? Given the rigor of the statistical analysis that we are going to perform, now we can choose a more <em>inclusive</em> consensus set. The default is to make a consensus peakset using peaks identified <strong>in at least 2 samples</strong>.</p>
</blockquote>
</section>
<section id="counting-reads-in-consensus-peaks" class="level3">
<h3 class="anchored" data-anchor-id="counting-reads-in-consensus-peaks">Counting reads in consensus peaks</h3>
<p>Once consensus genomic regions are defined, the next step is to <strong>count the number of sequencing reads that align to these regions</strong>. This read counting process provides <strong>quantitative information</strong> about the strength and extent of protein binding within the identified peaks.</p>
<blockquote class="blockquote">
<p>Uniquely mapped reads can be counted within peaks in the consensus using a tool called <code>FeatureCounts</code>.</p>
</blockquote>
<p>Sample counts for all the consensus peaks are output as a tabular file, in which <strong>each row represents one peak</strong>, and you have <strong>one column for each sample</strong>. We will now load one and take a closer look: this will be our starting point in the <em>hands-on</em> analysis of a ChIP-seq dataset.</p>
<blockquote class="blockquote">
<p>Before going on, let’s summarize the steps of a ChIP-seq analysis workflow that we have seen so far with the following scheme. You can find the file format names associated to the output of each task.</p>
</blockquote>
<center>
<img src="../pics/Workflow_chipseq.png" class="img-fluid" width="647">
</center>
</section>
</section>
<section id="the-tested-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-tested-dataset">The tested dataset</h2>
<p>The dataset we will analyze comes from this paper published from our lab in 2021:</p>
<blockquote class="blockquote">
<p>Della Chiara, Gervasoni, Fakiola, Godano et al., 2021 - Epigenomic landscape of human colorectal cancer unveils an aberrant core of pan-cancer enhancers orchestrated by YAP/TAZ</p>
</blockquote>
<p>Its main object was to explore the way cancer cells use enhancers as opposed to nonmalignant cells, and we did so by using <strong>ChIP-seq on histone marks</strong> extensively. We generated <strong>organoid lines to model colorectal tumors</strong>, analyzed their epigenome, and compared it to the ATAC-seq-derived chromatin activity data of multiple other malignancies. We found a small number of <strong>enhancer sequences were conserved</strong> across all these types, and identified a transcription factor that linked them - the YAP/TAZ pair - that when perturbed would cause the death of malignant, but not normal, organoids, therefore representing a potential pan-cancer therapeutic target.</p>
<p><img src="../pics/graphical_abstract_yap_taz_1.png" class="img-fluid"></p>
<p><img src="../pics/graphical_abstract_yap_taz_2.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>✅ In this workshop, we will re-analyze a portion of the ChIP-seq dataset used in the paper, pertaining to <strong>Histone 3 Lysine 27 Acetylation</strong> - a marker of activation present at active regulatory sequences, enhancers and promoters alike.</p>
</blockquote>
</section>
<section id="load-and-explore-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="load-and-explore-the-dataset">Load and explore the dataset</h2>
<p>In order to speed up the computations and keep memory usage low, we have <strong>subset the dataset only to chromosome 12</strong>. It will be interesting to see if we can recapitulate similar analyses by looking only at a single chromosome 🤓.</p>
<p>Data are in this public Google Drive <a href="https://drive.google.com/drive/folders/1-9yQESQn3JOvP9jqoWcqfgOZyqAC5M6J?usp=sharing">folder</a>. You will find:</p>
<ol type="1">
<li><code>raw_counts_chr12.matrix</code>: the <strong>peak by sample matrix</strong> containing the number of reads detected for each peak in each sample.</li>
<li><code>colData.txt</code>: a tabular file containing our <strong>metadata</strong> related to columns of the count table, which contains different info about our samples (e.g.&nbsp;the treatment, the sample origin, etc.).</li>
<li><code>peakset.bed</code>: a BED file with the chromosome locations of the entire consensus peakset (i.e.&nbsp;all chromosomes).</li>
<li><code>recurrence_chr12.matrix</code>: this is a table where you can find if any of the intervals that constitute the consensus peakset is also called as peak in each separate sample. Remember that when a consensus peakset is created, usually genomic intervals called ad peaks in at least 2 out of all the samples are kept in the consensus. Therefore, in the consensus you might find intervals that are called in 3 or in all the samples. It might be interesting to check how the peaks are distributed.</li>
<li><code>dba_Korg_Ntissue_homer_annot.txt</code>: this file contains information about the annotation of each consensus peakset to the nearest gene TSS. You will understand later its usage.</li>
<li><code>Korg_UP_regions_results.txt</code> and <code>Ncr_UP_regions_results.txt</code>: these files store the differential analysis results for the entire peakset and we will need them on day 3 to perform downstream functional analyses.</li>
</ol>
<p>Open the folder through Google Drive, check the presence of the files in the browser and THEN run the code below.</p>
<blockquote class="blockquote">
<p>After you run the code below, look into your <code>R</code> console and check if you are prompted to insert your Google account information. Do so and then follow the instructions to connect to your Google account in order to download the data from the shared folder!</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load installed packages with the "library()" function</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(googledrive)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load files</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">drive_ls</span>(<span class="at">path=</span><span class="st">"MOBW2024_uploadata"</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># File paths with URL</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> files[files<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"raw_counts_chr12.matrix"</span>,] <span class="sc">%&gt;%</span> <span class="fu">drive_read_string</span>() <span class="sc">%&gt;%</span> <span class="fu">read.table</span>(<span class="at">text =</span> ., <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> files[files<span class="sc">$</span>name <span class="sc">==</span> <span class="st">"colData.txt"</span>,] <span class="sc">%&gt;%</span> <span class="fu">drive_read_string</span>() <span class="sc">%&gt;%</span> <span class="fu">read.table</span>(<span class="at">text =</span> ., <span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now explore the data that we have just loaded in the current R session to familiarize with it.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check out the counts</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(counts, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2157</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_1990</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2010</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2163</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2204</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2212</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2216</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2222</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2288</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2303</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2298</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SQ_2145</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GSM2058021</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GSM2058022</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">GSM2058023</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">reg_6364</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">97</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">185</td>
</tr>
<tr class="even">
<td style="text-align: left;">reg_6365</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">216</td>
</tr>
<tr class="odd">
<td style="text-align: left;">reg_6366</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">169</td>
</tr>
<tr class="even">
<td style="text-align: left;">reg_6367</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">132</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">188</td>
</tr>
<tr class="odd">
<td style="text-align: left;">reg_6368</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">56</td>
</tr>
<tr class="even">
<td style="text-align: left;">reg_6369</td>
<td style="text-align: right;">184</td>
<td style="text-align: right;">304</td>
<td style="text-align: right;">215</td>
<td style="text-align: right;">661</td>
<td style="text-align: right;">278</td>
<td style="text-align: right;">519</td>
<td style="text-align: right;">466</td>
<td style="text-align: right;">435</td>
<td style="text-align: right;">500</td>
<td style="text-align: right;">267</td>
<td style="text-align: right;">1045</td>
<td style="text-align: right;">297</td>
<td style="text-align: right;">1950</td>
<td style="text-align: right;">1562</td>
<td style="text-align: right;">3860</td>
</tr>
<tr class="odd">
<td style="text-align: left;">reg_6370</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">136</td>
</tr>
<tr class="even">
<td style="text-align: left;">reg_6371</td>
<td style="text-align: right;">141</td>
<td style="text-align: right;">290</td>
<td style="text-align: right;">281</td>
<td style="text-align: right;">673</td>
<td style="text-align: right;">196</td>
<td style="text-align: right;">398</td>
<td style="text-align: right;">438</td>
<td style="text-align: right;">303</td>
<td style="text-align: right;">451</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">666</td>
<td style="text-align: right;">222</td>
<td style="text-align: right;">1793</td>
<td style="text-align: right;">1409</td>
<td style="text-align: right;">3416</td>
</tr>
<tr class="odd">
<td style="text-align: left;">reg_6372</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">222</td>
</tr>
<tr class="even">
<td style="text-align: left;">reg_6373</td>
<td style="text-align: right;">63</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">293</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">168</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">268</td>
<td style="text-align: right;">135</td>
<td style="text-align: right;">187</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">580</td>
<td style="text-align: right;">229</td>
<td style="text-align: right;">894</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>We can then check the shape of our counts table (i.e.&nbsp;how many different peaks we are detecting and how many different samples?)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many rows and columns does our count table have?</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1581   15</code></pre>
</div>
</div>
<p>We can see that our table contains count information for 1581 peaks and 15 samples.</p>
<p>We can also inspect the <strong>metadata</strong> from the samples which is stored in the <code>samples</code> object we created above.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What does the table look like?</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>samples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">groups</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sizeFactor</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Tissue</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">SampleID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">SQ_2157</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.489936</td>
<td style="text-align: left;">4KE</td>
<td style="text-align: left;">SQ_2157</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="even">
<td style="text-align: left;">SQ_1990</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.758060</td>
<td style="text-align: left;">8KE</td>
<td style="text-align: left;">SQ_1990</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SQ_2010</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.760352</td>
<td style="text-align: left;">10KE</td>
<td style="text-align: left;">SQ_2010</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="even">
<td style="text-align: left;">SQ_2163</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.425892</td>
<td style="text-align: left;">13KE</td>
<td style="text-align: left;">SQ_2163</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SQ_2204</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">1.863534</td>
<td style="text-align: left;">18KE</td>
<td style="text-align: left;">SQ_2204</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="even">
<td style="text-align: left;">SQ_2212</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.580778</td>
<td style="text-align: left;">11KW</td>
<td style="text-align: left;">SQ_2212</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SQ_2216</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.159358</td>
<td style="text-align: left;">24KE</td>
<td style="text-align: left;">SQ_2216</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="even">
<td style="text-align: left;">SQ_2222</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.203927</td>
<td style="text-align: left;">22KE</td>
<td style="text-align: left;">SQ_2222</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SQ_2288</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.402964</td>
<td style="text-align: left;">36KE</td>
<td style="text-align: left;">SQ_2288</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="even">
<td style="text-align: left;">SQ_2303</td>
<td style="text-align: left;">K_org</td>
<td style="text-align: right;">2.430445</td>
<td style="text-align: left;">41KE</td>
<td style="text-align: left;">SQ_2303</td>
<td style="text-align: left;">K_org</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SQ_2298</td>
<td style="text-align: left;">N_crypts</td>
<td style="text-align: right;">3.756529</td>
<td style="text-align: left;">CR_41_mp</td>
<td style="text-align: left;">SQ_2298</td>
<td style="text-align: left;">N_crypts</td>
</tr>
<tr class="even">
<td style="text-align: left;">SQ_2145</td>
<td style="text-align: left;">N_crypts</td>
<td style="text-align: right;">2.804850</td>
<td style="text-align: left;">CR_28_mp</td>
<td style="text-align: left;">SQ_2145</td>
<td style="text-align: left;">N_crypts</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GSM2058021</td>
<td style="text-align: left;">N_crypts</td>
<td style="text-align: right;">1.252530</td>
<td style="text-align: left;">CR_28</td>
<td style="text-align: left;">GSM2058021</td>
<td style="text-align: left;">N_crypts</td>
</tr>
<tr class="even">
<td style="text-align: left;">GSM2058022</td>
<td style="text-align: left;">N_crypts</td>
<td style="text-align: right;">1.000000</td>
<td style="text-align: left;">CR_29</td>
<td style="text-align: left;">GSM2058022</td>
<td style="text-align: left;">N_crypts</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GSM2058023</td>
<td style="text-align: left;">N_crypts</td>
<td style="text-align: right;">2.476903</td>
<td style="text-align: left;">CR_37</td>
<td style="text-align: left;">GSM2058023</td>
<td style="text-align: left;">N_crypts</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What is the shape of this samples table?</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15  5</code></pre>
</div>
</div>
<p>In this case, this <code>samples</code> table has as many rows (15) as there are samples (which in turn is equal to the number of columns in the <code>counts</code> table), with columns containing different types of information related to each of the samples in the analysis.</p>
</section>
<section id="savingloading-files" class="level2">
<h2 class="anchored" data-anchor-id="savingloading-files">Saving/Loading Files</h2>
<p><strong>Let’s save this object with samples information in a file on this cloud session</strong>, this might be needed later if we end up in some trouble with the <code>R</code> session! We will save it in a file format where columns are separated by commas. You might be familiar with this format if you have worked quite a bit in Excel. In <code>R</code>, we can save tabular data with the <code>write.table()</code> function specifying the location (the file name) we want. This is <strong>useful in the case our <code>R</code> session dies or we decide to interrupt it</strong>. In this case we will not have to run the whole analysis from the beginning and we can just source the file and load it!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(samples, <span class="st">"samples_table.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can <strong>load the object back into the current session</strong> by using the following code line:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">"samples_table.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p><strong>We will also repeat this procedure with the results of the differential expression analysis in order to avoid repeating work we have already done in case of any trouble!</strong></p>
</blockquote>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Jacopo Arrigoni &amp; Carolina Dossena</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>